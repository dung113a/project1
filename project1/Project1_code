# 1. Thá»i gian

# 2. MÃ´ táº£ cÃ´ng viá»‡c

Dá»¯ liá»‡u trÃªn Ä‘ang Ä‘Æ°á»£c Ä‘áº·t trÃªn Linux server, cáº§n team Data Engineer sá»­ dá»¥ng command line Linux há»— trá»£ cÃ¡c tÃ¡c vá»¥ sau Ä‘á»ƒ cÃ³ cÃ¡c thÃ´ng tin cÆ¡ báº£n vá» dá»¯ liá»‡u

1. Sáº¯p xáº¿p cÃ¡c bá»™ phim theo ngÃ y phÃ¡t hÃ nh giáº£m dáº§n rá»“i lÆ°u ra má»™t file má»›i
2. Lá»c ra cÃ¡c bá»™ phim cÃ³ Ä‘Ã¡nh giÃ¡ trung bÃ¬nh trÃªn 7.5 rá»“i lÆ°u ra má»™t file má»›i
3. TÃ¬m ra phim nÃ o cÃ³ doanh thu cao nháº¥t vÃ  doanh thu tháº¥p nháº¥t
4. TÃ­nh tá»•ng doanh thu táº¥t cáº£ cÃ¡c bá»™ phim
5. Top 10 bá»™ phim Ä‘em vá» lá»£i nhuáº­n cao nháº¥t
6. Äáº¡o diá»…n nÃ o cÃ³ nhiá»u bá»™ phim nháº¥t vÃ  diá»…n viÃªn nÃ o Ä‘Ã³ng nhiá»u phim nháº¥t
7. Thá»‘ng kÃª sá»‘ lÆ°á»£ng phim theo cÃ¡c thá»ƒ loáº¡i. VÃ­ dá»¥ cÃ³ bao nhiÃªu phim thuá»™c thá»ƒ loáº¡i Action, bao nhiÃªu thuá»™c thá»ƒ loáº¡i Family, â€¦.
8. Idea cá»§a báº¡n Ä‘á»ƒ cÃ³ thÃªm nhá»¯ng phÃ¢n tÃ­ch cho dá»¯ liá»‡u?

# 3. Kiáº¿n  thá»©c thu Ä‘Æ°á»£c

# 4. MÃ£ code

---

### **1. Sáº¯p xáº¿p cÃ¡c bá»™ phim theo ngÃ y phÃ¡t hÃ nh giáº£m dáº§n**

Lá»‡nh:

```
awk -F',' '{
    split($16, date, "/");
    printf "%04d-%02d-%02d,", (date[3] < 50 ? 2000 + date[3] : 1900 + date[3]), date[1], date[2];
    for (i=1; i<=NF; i++) printf "%s%s", $i, (i<NF?FS:ORS);
}' movies.csv | sort -t ',' -k1r > sorted_by_date.csv

```

**Giáº£i thÃ­ch**:

- **`awk`**: DÃ¹ng Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u theo tá»«ng dÃ²ng.
    - `split($16, date, "/")`: TÃ¡ch cá»™t thá»© 16 (ngÃ y phÃ¡t hÃ nh) thÃ nh cÃ¡c pháº§n tá»­ ngÃ y, thÃ¡ng, nÄƒm.
    - `printf "%04d-%02d-%02d"`: Äá»‹nh dáº¡ng láº¡i ngÃ y/thÃ¡ng/nÄƒm thÃ nh dáº¡ng `YYYY-MM-DD` Ä‘á»ƒ thuáº­n tiá»‡n cho viá»‡c sáº¯p xáº¿p.
    - `for (i=1; i<=NF; i++)`: Láº·p qua táº¥t cáº£ cÃ¡c cá»™t Ä‘á»ƒ in láº¡i dÃ²ng dá»¯ liá»‡u.
- **`sort -t ',' -k1r`**: Sáº¯p xáº¿p dá»¯ liá»‡u theo cá»™t Ä‘áº§u tiÃªn (ngÃ y thÃ¡ng) giáº£m dáº§n (`k1r`).
- `sort -t ','`: Chá»‰ Ä‘á»‹nh dáº¥u pháº©y (`,`) lÃ  kÃ½ tá»± phÃ¢n tÃ¡ch cÃ¡c trÆ°á»ng (field) trong file.
- `k1r`: Sáº¯p xáº¿p theo trÆ°á»ng Ä‘áº§u tiÃªn (field 1) theo thá»© tá»± giáº£m dáº§n (`r`Â lÃ  viáº¿t táº¯t cá»§a "reverse").

**ChÃº Ã½**:

- Náº¿u cá»™t ngÃ y thÃ¡ng khÃ´ng pháº£i lÃ  cá»™t thá»© 16, cáº§n thay `$16` báº±ng cá»™t chÃ­nh xÃ¡c.
- Káº¿t quáº£ Ä‘Æ°á»£c lÆ°u trong file `sorted_by_date.csv`.

---

### **2. Lá»c cÃ¡c bá»™ phim cÃ³ Ä‘Ã¡nh giÃ¡ trung bÃ¬nh trÃªn 7.5**

Lá»‡nh:

```
csvsql --query "SELECT * FROM movies WHERE vote_average > 7.5 ORDER BY vote_average DESC" movies.csv > task2.csv

```

**Giáº£i thÃ­ch**:

- **`csvsql`**: Má»™t cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ xá»­ lÃ½ file CSV nhÆ° má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u SQL.
    - `SELECT *`: Chá»n táº¥t cáº£ cÃ¡c cá»™t.
    - `WHERE vote_average > 7.5`: Lá»c cÃ¡c bá»™ phim cÃ³ Ä‘Ã¡nh giÃ¡ trung bÃ¬nh lá»›n hÆ¡n 7.5.
    - `ORDER BY vote_average DESC`: Sáº¯p xáº¿p theo Ä‘Ã¡nh giÃ¡ giáº£m dáº§n.
- Káº¿t quáº£ lÆ°u trong file `task2.csv`.

**ChÃº Ã½**:

- Äáº£m báº£o cÃ i Ä‘áº·t thÆ° viá»‡n `csvkit` Ä‘á»ƒ sá»­ dá»¥ng lá»‡nh `csvsql`.
- Náº¿u dá»¯ liá»‡u bá»‹ lá»—i (vÃ­ dá»¥: thiáº¿u giÃ¡ trá»‹), cáº§n xá»­ lÃ½ trÆ°á»›c khi cháº¡y lá»‡nh.

---

### **3. TÃ¬m phim cÃ³ doanh thu cao nháº¥t vÃ  tháº¥p nháº¥t**

Lá»‡nh:

```
awk -F',' 'NR==1 {next} {if ($5+0 > max) {max=$5; max_line=$0} if ($5+0 < min || NR==2) {min=$5; min_line=$0}} END {print "Highest Revenue:", max; print max_line; print "Lowest Revenue:", min; print min_line}' movies.csv

```

**Giáº£i thÃ­ch**:

- **`NR==1 {next}`**: Bá» qua dÃ²ng tiÃªu Ä‘á».
- **`if ($5+0 > max)`**: Kiá»ƒm tra náº¿u doanh thu (cá»™t 5) lá»›n hÆ¡n giÃ¡ trá»‹ lá»›n nháº¥t hiá»‡n táº¡i.
- **`if ($5+0 < min || NR==2)`**: Kiá»ƒm tra náº¿u doanh thu nhá» hÆ¡n giÃ¡ trá»‹ nhá» nháº¥t hiá»‡n táº¡i hoáº·c lÃ  dÃ²ng Ä‘áº§u tiÃªn sau tiÃªu Ä‘á».
- **`END`**: Sau khi Ä‘á»c háº¿t file, in ra káº¿t quáº£.

**ChÃº Ã½**:

- Cá»™t doanh thu (`$5`) pháº£i Ä‘Ãºng vá»›i vá»‹ trÃ­ trong file CSV. Náº¿u khÃ´ng, cáº§n thay Ä‘á»•i cho phÃ¹ há»£p.

---

### **4. TÃ­nh tá»•ng doanh thu cá»§a táº¥t cáº£ cÃ¡c bá»™ phim**

Lá»‡nh:

```
awk -F',' 'NR > 1 {total += $5} END {print "Total Revenue:", total}' movies.csv

```

**Giáº£i thÃ­ch**:

- **`NR > 1`**: Bá» qua dÃ²ng tiÃªu Ä‘á».
- **`total += $5`**: Cá»™ng giÃ¡ trá»‹ doanh thu cá»§a tá»«ng dÃ²ng vÃ o biáº¿n `total`.
- **`END`**: In tá»•ng doanh thu sau khi Ä‘á»c háº¿t file.

**ChÃº Ã½**:

- Äáº£m báº£o cá»™t doanh thu (`$5`) chÃ­nh xÃ¡c.

---

### **5. Top 10 bá»™ phim cÃ³ lá»£i nhuáº­n cao nháº¥t**

Lá»‡nh:

```
awk -F',' 'NR > 1 {profit = $5 - $4; print profit "," $0}' movies.csv | sort -t',' -k1,1nr | head -n 10 > top_10_profitable_movies.csv

```

**Giáº£i thÃ­ch**:

- **`profit = $5 - $4`**: TÃ­nh lá»£i nhuáº­n báº±ng cÃ¡ch láº¥y doanh thu (`$5`) trá»« chi phÃ­ sáº£n xuáº¥t (`$4`).
- **`sort -t',' -k1,1nr`**: Sáº¯p xáº¿p theo cá»™t lá»£i nhuáº­n giáº£m dáº§n.
- **`head -n 10`**: Láº¥y 10 dÃ²ng Ä‘áº§u tiÃªn.

**ChÃº Ã½**:

- Äáº£m báº£o cá»™t doanh thu vÃ  chi phÃ­ sáº£n xuáº¥t Ä‘Ãºng vá»‹ trÃ­.

---

### **6. Äáº¡o diá»…n vÃ  diá»…n viÃªn cÃ³ nhiá»u phim nháº¥t**

### Äáº¡o diá»…n:

```
awk -F',' 'NR>1 && $9 != "" {count[$9]++} END {
    max = 0;
    for (name in count) {
        if (count[name] > max) {
            max = count[name];
            top_director = name;
        }
    }
    print "The director with the most films:", max, top_director;
}' movies.csv > task6.csv

```

### Diá»…n viÃªn:

```
awk -F',' 'NR > 1 {
    split($7, actors, "|");
    for (i in actors) count[actors[i]]++;
} END {
    max_count = 0;
    max_actor = "";
    for (actor in count) {
        if (count[actor] > max_count) {
            max_count = count[actor];
            max_actor = actor;
        }
    }
    print "The actor with the most films:", max_actor, "with", max_count, "films";
}' movies.csv

```

**Giáº£i thÃ­ch**:

- **Äáº¡o diá»…n**: Äáº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a má»—i Ä‘áº¡o diá»…n (`$9`).
- **Diá»…n viÃªn**: TÃ¡ch danh sÃ¡ch diá»…n viÃªn (`$7`) báº±ng kÃ½ tá»± `|`, sau Ä‘Ã³ Ä‘áº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a tá»«ng diá»…n viÃªn.

**ChÃº Ã½**:

- Äáº£m báº£o cá»™t Ä‘áº¡o diá»…n vÃ  diá»…n viÃªn Ä‘Ãºng vá»‹ trÃ­.

---

### **7. Thá»‘ng kÃª sá»‘ lÆ°á»£ng phim theo thá»ƒ loáº¡i**

Lá»‡nh:

```
awk -F',' 'NR > 1 {
    split($6, genres, "|");
    for (i in genres) count[genres[i]]++;
} END {
    for (genre in count) print genre, count[genre];
}' movies.csv > genre_count.csv

```

**Giáº£i thÃ­ch**:

- **`split($6, genres, "|")`**: TÃ¡ch cÃ¡c thá»ƒ loáº¡i (cá»™t 6) báº±ng kÃ½ tá»± `|`.
- **`count[genres[i]]++`**: Äáº¿m sá»‘ láº§n xuáº¥t hiá»‡n cá»§a tá»«ng thá»ƒ loáº¡i.

---

### **8. Ã tÆ°á»Ÿng má»Ÿ rá»™ng phÃ¢n tÃ­ch dá»¯ liá»‡u**

- **PhÃ¢n tÃ­ch xu hÆ°á»›ng**:
    - Doanh thu trung bÃ¬nh cá»§a cÃ¡c bá»™ phim qua tá»«ng nÄƒm.
    - Xu hÆ°á»›ng thá»ƒ loáº¡i phim phá»• biáº¿n theo thá»i gian.
- **Hiá»‡u quáº£ cá»§a Ä‘áº¡o diá»…n**:
    - Äáº¡o diá»…n nÃ o táº¡o ra doanh thu trung bÃ¬nh cao nháº¥t.
- **PhÃ¢n tÃ­ch diá»…n viÃªn**:
    - Diá»…n viÃªn nÃ o gÃ³p máº·t trong cÃ¡c bá»™ phim cÃ³ doanh thu cao nháº¥t.
- **PhÃ¢n tÃ­ch Ä‘Ã¡nh giÃ¡**:
    - Má»‘i quan há»‡ giá»¯a chi phÃ­ sáº£n xuáº¥t vÃ  Ä‘Ã¡nh giÃ¡ trung bÃ¬nh.

---

Náº¿u báº¡n cáº§n thÃªm há»— trá»£ hoáº·c muá»‘n giáº£i thÃ­ch chi tiáº¿t hÆ¡n, cá»© thoáº£i mÃ¡i há»i nhÃ©! ğŸ˜Š
